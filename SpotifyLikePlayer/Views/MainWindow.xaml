<Window x:Class="SpotifyLikePlayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpotifyLikePlayer"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:SpotifyLikePlayer.Converters"
		xmlns:i="http://schemas.microsoft.com/xaml/behaviors" 
		xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
		xmlns:models="clr-namespace:SpotifyLikePlayer.Models"
		mc:Ignorable="d"
        Title="PATHTRACK" Height="600" Width="860" SizeToContent="Manual" ResizeMode="CanResize" MinWidth="900" MinHeight="600"
        DataContext="{Binding RelativeSource={RelativeSource Self}, Path=ViewModel}"
        WindowStartupLocation="CenterScreen" WindowState="Maximized" Topmost="False">
	<Window.Resources>
		<converters:SecondsToTimeConverter x:Key="SecondsToTimeConverter" />
		<Style TargetType="{x:Type GridViewColumnHeader}" BasedOn="{StaticResource {x:Type GridViewColumnHeader}}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type GridViewColumnHeader}">
						<Grid IsHitTestVisible="False">
							<Border
                        x:Name="HeaderBorder"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        Background="{TemplateBinding Background}"
                        Padding="{TemplateBinding Padding}">
								<ContentPresenter
                            x:Name="HeaderContent"
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                            RecognizesAccessKey="True"
                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
							</Border>
						</Grid>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource MaterialDesignFlatButtonClick}" />
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource MaterialDesignFlatButtonRipple}" />
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<Style x:Key="GenreButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="#2E2E2E"/>
			<Setter Property="Foreground" Value="Lime"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="BorderBrush" Value="Lime"/>
			<Setter Property="BorderThickness" Value="1.5"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border Background="{TemplateBinding Background}" 
                        BorderBrush="{TemplateBinding BorderBrush}" 
                        BorderThickness="{TemplateBinding BorderThickness}" 
                        CornerRadius="6" Padding="8,4">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="#3A3A3A"/>
								<Setter Property="BorderBrush" Value="LawnGreen"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<Style TargetType="MenuItem">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontSize" Value="13"/>
			<Setter Property="Padding" Value="6,3"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="MenuItem">
						<Border Background="{TemplateBinding Background}"
                            CornerRadius="4"
                            Padding="4,2"
                            Margin="1">
							<ContentPresenter />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsHighlighted" Value="True">
								<Setter Property="Background" Value="#333"/>
								<Setter Property="Foreground" Value="Lime"/>
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter Property="Foreground" Value="#777"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<CollectionViewSource x:Key="PlaylistsViewSource" Source="{Binding Playlists}">
			<CollectionViewSource.SortDescriptions>
				<componentModel:SortDescription PropertyName="Name" Direction="Ascending" />
			</CollectionViewSource.SortDescriptions>
			<CollectionViewSource.GroupDescriptions>
				<PropertyGroupDescription PropertyName="IsFavoriteList" />
			</CollectionViewSource.GroupDescriptions>
		</CollectionViewSource>
	</Window.Resources>
	<Grid Background="MediumPurple">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="200" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="80" />
		</Grid.RowDefinitions>

		<Grid Grid.Row="0" Grid.ColumnSpan="2" Background="#1E1E1E">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>
			<TextBlock Grid.Row="0" Text="Сейчас играет" Foreground="White" FontWeight="Bold" 
                       FontSize="18" Margin="10,5" HorizontalAlignment="Left" />
			<TextBlock Grid.Row="0" Text="Справка" Foreground="White" FontWeight="Bold" 
           FontSize="18" Margin="10,7,50,0" HorizontalAlignment="Right" Cursor="" />
			<Button x:Name="HelpButton" Grid.Row="0" Width="60" Height="35" Margin="2" HorizontalAlignment="Right" VerticalAlignment="Top" Background="Transparent" BorderBrush="{x:Null}" Click="HelpButton_Click" ToolTip="О программе">
				<materialDesign:PackIcon Kind="InformationOutline" Width="26" Height="26" Foreground="LightSkyBlue"/>
			</Button>
			<Grid Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,5,0,5" VerticalAlignment="Center">
					<Image Source="{Binding PlayerService.CurrentSong.CoverImage, FallbackValue={x:Null}}" 
                           Width="100" Height="100" Stretch="UniformToFill" Margin="0,0,10,0"/>
					<StackPanel Orientation="Vertical">
						<TextBlock Text="{Binding PlayerService.CurrentSong.Title, TargetNullValue='Unknown Title'}" 
                                   Foreground="White" FontWeight="Bold" FontSize="28"/>
						<TextBlock Text="{Binding PlayerService.CurrentSong.Artist.Name, TargetNullValue='Unknown Artist'}" 
                                   Foreground="LimeGreen" FontSize="19" FontWeight="SemiBold" Cursor=""/>
						<TextBlock Text="{Binding PlayerService.CurrentSong.Album.Title, TargetNullValue='Unknown Album'}" 
                                   Foreground="LimeGreen" FontSize="17"/>
					</StackPanel>
				</StackPanel>
				<Grid Grid.Column="1" VerticalAlignment="Center">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>

					<DockPanel HorizontalAlignment="Center" VerticalAlignment="Center" LastChildFill="False">
						<TextBox x:Name="SearchBox"
                 Width="400"
                 Height="46"
                 FontSize="18"
                 Padding="10,2,10,2"
                 Background="#222"
                 BorderBrush="#444"
                 BorderThickness="1"
                 Foreground="White"
                 VerticalAlignment="Center"
                 materialDesign:HintAssist.Hint="Поиск трека, исполнителя или альбома..."
                 TextChanged="SearchBox_TextChanged"
                 KeyDown="SearchBox_KeyDown"
                 GotFocus="SearchBox_GotFocus"/>

						<StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
							<materialDesign:PackIcon Kind="Album"
                                     Width="27" Height="27"
                                     Foreground="#CCCCCC"
                                     VerticalAlignment="Center"
                                     Opacity="0.8"/>
							<TextBlock x:Name="MusicContextText"
                       Text="Вся музыка"
                       FontSize="26"
                       FontWeight="SemiBold"
                       Foreground="#DDDDDD"
                       VerticalAlignment="Center"
                       Margin="6,0,0,0"
                       Opacity="0.9"
                       TextTrimming="CharacterEllipsis"/>
						</StackPanel>
					</DockPanel>
				</Grid>

				<Popup x:Name="SuggestionsPopup"
           PlacementTarget="{Binding ElementName=SearchBox}"
           Placement="Bottom"
           AllowsTransparency="True"
           StaysOpen="False"
           Focusable="False">
					<Border Background="#1E1E1E"
                BorderBrush="#444"
                BorderThickness="1"
                CornerRadius="8"
                Padding="4"
                SnapsToDevicePixels="True"
                Width="{Binding ActualWidth, ElementName=SearchBox}">
						<ScrollViewer MaxHeight="220"
                          VerticalScrollBarVisibility="Auto">
							<ListBox x:Name="SuggestionsList"
                         Background="Transparent"
                         BorderThickness="0"
                         Foreground="White"
                         FontSize="16"
                         MouseLeftButtonUp="SuggestionsList_MouseLeftButtonUp" PreviewMouseWheel="SuggestionsList_PreviewMouseWheel">

								<ListBox.ItemTemplate>
									<DataTemplate>
										<Grid Margin="6">
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="Auto"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>

											<materialDesign:PackIcon Kind="MusicNote"
                                                         Width="24" Height="24"
                                                         Foreground="LightSkyBlue"
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,10,0"/>

											<StackPanel Grid.Column="1" VerticalAlignment="Center">
												<TextBlock Text="{Binding Title}"
                                               FontWeight="Bold"
                                               Foreground="White"
                                               FontSize="16"/>
												<TextBlock Text="{Binding Artist.Name}"
                                               Foreground="#AAAAAA"
                                               FontSize="14"/>
											</StackPanel>
										</Grid>
									</DataTemplate>
								</ListBox.ItemTemplate>

								<ListBox.ItemContainerStyle>
									<Style TargetType="ListBoxItem">
										<Setter Property="Padding" Value="4"/>
										<Setter Property="Cursor" Value="Hand"/>
										<Setter Property="Template">
											<Setter.Value>
												<ControlTemplate TargetType="ListBoxItem">
													<Border x:Name="border"
                                                Background="Transparent"
                                                CornerRadius="6"
                                                Padding="{TemplateBinding Padding}">
														<ContentPresenter/>
													</Border>
													<ControlTemplate.Triggers>
														<Trigger Property="IsMouseOver" Value="True">
															<Setter TargetName="border" Property="Background" Value="#333"/>
														</Trigger>
														<Trigger Property="IsSelected" Value="True">
															<Setter TargetName="border" Property="Background" Value="#444"/>
														</Trigger>
													</ControlTemplate.Triggers>
												</ControlTemplate>
											</Setter.Value>
										</Setter>
									</Style>
								</ListBox.ItemContainerStyle>
							</ListBox>
						</ScrollViewer>
					</Border>
				</Popup>
				<StackPanel Grid.Column="2" Orientation="Vertical"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,5,10,0">
					<Button x:Name="ProfileButton"
            Margin="100,0,0,10"
            Width="180"
            Height="40"
            Background="#222"
            Foreground="White"
            BorderBrush="#444"
            BorderThickness="1"
            Click="ProfileButton_Click">
						<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
							<materialDesign:PackIcon Kind="AccountCircle" Width="26" Height="26" Foreground="Lime"/>
							<TextBlock Text="Профиль" Margin="6,0,0,0" FontSize="20" VerticalAlignment="Center" FontWeight="Bold"/>
						</StackPanel>
					</Button>
					<Button Grid.Column="2" x:Name="ChangeGenreButton" Margin="0,0,0,20"
        Style="{StaticResource GenreButtonStyle}"
        Click="ChangeGenreButton_Click">
						<Button.Content>
							<StackPanel Orientation="Horizontal" Cursor="">
								<materialDesign:PackIcon Kind="Music" Width="26" Height="26" Margin="0,0,6,0" Foreground="Lime"/>
								<TextBlock Text="Изменить жанр" FontSize="20" FontWeight="Bold"/>
							</StackPanel>
						</Button.Content>
					</Button>
				</StackPanel>
			</Grid>
		</Grid>

		<StackPanel Grid.Column="0" Grid.Row="1" Background="#121212">
			<Button Content="Home" FontSize="20" Click="HomeButton_Click" Height="34" Margin="5,5,5,5" Command="{Binding HomeCommand}"/>
			<TextBlock Text="Плейлисты" Foreground="White" FontSize="20"
               FontWeight="Bold" Margin="10,10,0,10"/>
			<ListBox x:Name="PlaylistsListBox"
         MouseDoubleClick="PlaylistsListBox_MouseDoubleClick"
         ItemsSource="{Binding Playlists}"
         SelectedItem="{Binding SelectedPlaylist}"
         SelectionChanged="Playlist_SelectionChanged"
         Background="#121212"
         Foreground="White"
         BorderThickness="0">

				<ListBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Name}"
                       FontSize="18"
                       Padding="8"
                       FontWeight="SemiBold">
							<TextBlock.Style>
								<Style TargetType="TextBlock">
									<Setter Property="Foreground" Value="White"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding Name}" Value="Favorite">
											<Setter Property="Foreground" Value="Lime"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
					</DataTemplate>
				</ListBox.ItemTemplate>

				<ListBox.ContextMenu>
					<ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
						<MenuItem Header="Удалить плейлист"
                      Command="{Binding DeletePlaylistCommand}"
                      CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
					</ContextMenu>
				</ListBox.ContextMenu>
			</ListBox>
		</StackPanel>
		

		<Grid Grid.Column="1" Grid.Row="1">

			<Border x:Name="SongInfoPanel"
        Background="#1E1E1E"
        Height="200"
        Padding="20"
        Margin="0,10,0,0"
        Visibility="Collapsed"
        HorizontalAlignment="Center"
        VerticalAlignment="Top"
        Width="600"
        CornerRadius="10"
        Panel.ZIndex="10">
				<Border.RenderTransform>
					<TranslateTransform Y="-200"/>
				</Border.RenderTransform>

				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<Border CornerRadius="6" Margin="0,0,20,0">
						<Image Source="{Binding SelectedSong.CoverImage}"
                   Width="160" Height="160"
                   Stretch="UniformToFill"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Center"/>
					</Border>

					<StackPanel Grid.Column="1"
                    Orientation="Vertical"
                    VerticalAlignment="Center"
                    Margin="10,0,0,0">
						<TextBlock Text="{Binding SelectedSong.Title}"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="White"
                       Margin="160,0,0,0"/>

						<TextBlock Text="{Binding SelectedSong.Artist.Name}"
                       FontSize="16"
                       Foreground="#CCCCCC" Margin="160,0,0,0"/>

						<TextBlock Text="{Binding SelectedSong.Album.Title}"
                       FontSize="14"
                       Foreground="#AAAAAA"
                       Margin="160,0,0,0"/>

						<StackPanel Orientation="Horizontal" Margin="0,8,0,0">
							<TextBlock Text="{Binding SelectedSong.Album.ReleaseYear, StringFormat='Год: {0}'}"
                           Foreground="#AAAAAA" Margin="160,0,16,0"/>
							<TextBlock Text="{Binding SelectedSong.Genre, StringFormat='Жанр: {0}'}"
                           Foreground="#AAAAAA" Margin="0,0,16,0"/>
						</StackPanel>

						<StackPanel Orientation="Horizontal" Margin="0,14,0,0">
							<Button Content="Перейти к альбому"
                        Click="GoToAlbum_Click"
                        Background="#3A3A3A"
                        Foreground="White"
                        BorderBrush="LimeGreen"
                        BorderThickness="1"
                        Padding="10,4"
                        Margin="160,0,10,15"
                        Cursor="Hand"/>
							<Button Content="Закрыть"
                        Click="CloseSongInfo_Click"
                        Background="Transparent"
                        Foreground="#AAAAAA"
                        BorderBrush="#666"
                        BorderThickness="1"
                        Padding="10,4"
						Margin="0,0,10,15"
                        Cursor="Hand"/>
						</StackPanel>
					</StackPanel>
				</Grid>
			</Border>

			<ListView x:Name="SongsListView"
          ItemsSource="{Binding Songs}"
          SelectedItem="{Binding SelectedSong, Mode=TwoWay}"
          Margin="10"
          Background="#121212"
          Foreground="White"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          FontSize="18"
          MouseDoubleClick="SongsListView_MouseDoubleClick"
          VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.VirtualizationMode="Recycling"
          ScrollViewer.CanContentScroll="True"
          BorderThickness="0"
          Padding="4" Cursor="">

				<!-- Панель для виртуализации -->
				<ListView.ItemsPanel>
					<ItemsPanelTemplate>
						<VirtualizingStackPanel Orientation="Vertical"/>
					</ItemsPanelTemplate>
				</ListView.ItemsPanel>

				<!-- Шаблон отображения каждой песни -->
				<ListView.ItemTemplate>
					<DataTemplate>
						<Border Background="#1A1A1A"
                    CornerRadius="8"
                    Padding="8"
                    Margin="17,3"
                    SnapsToDevicePixels="True">
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="60"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="Auto"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>

								<!-- Обложка -->
								<Image Source="{Binding CoverImage}"
                           Width="50" Height="50"
                           Stretch="UniformToFill"
                           Margin="0,0,8,0"
                           VerticalAlignment="Center"/>

								<!-- Название, артист, индикатор IsPlaying -->
								<StackPanel Grid.Column="1" VerticalAlignment="Center">
									<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
										<materialDesign:PackIcon Kind="Equalizer"
                                                     Width="18" Height="18"
                                                     Foreground="Lime"
                                                     VerticalAlignment="Center"
                                                     Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVisibilityConverter}}"
                                                     Margin="0,0,4,0"/>
										<TextBlock Text="{Binding Title}"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       FontSize="18"
                                       TextTrimming="CharacterEllipsis"/>
									</StackPanel>
									<TextBlock Text="{Binding Artist.Name}"
                                   FontSize="14"
                                   Foreground="#AAAAAA"
                                   TextTrimming="CharacterEllipsis"/>
								</StackPanel>

								<!-- Длительность -->
								<TextBlock Grid.Column="2"
                               Text="{Binding Duration, StringFormat={}{0:mm\\:ss}}"
                               VerticalAlignment="Center"
                               Foreground="#BBBBBB"
                               Margin="8,0"/>

								<!-- Избранное -->
								<Button Grid.Column="3"
                            Style="{StaticResource FavoriteStarButton}"
                            Click="FavoriteButton_Click"
                            DataContext="{Binding}"
                            ToolTip="Добавить в избранное"/>
							</Grid>
						</Border>
					</DataTemplate>
				</ListView.ItemTemplate>

				<!-- Стиль контейнера для эффектов выбора и hover -->
				<ListView.ItemContainerStyle>
					<Style TargetType="ListViewItem">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
						<Setter Property="Padding" Value="0"/>
						<Setter Property="SnapsToDevicePixels" Value="True"/>
						<Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
						<Setter Property="RenderTransform">
							<Setter.Value>
								<ScaleTransform ScaleX="1" ScaleY="1"/>
							</Setter.Value>
						</Setter>

						<Style.Triggers>
							<!-- Hover -->
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="#222"/>
								<Trigger.EnterActions>
									<BeginStoryboard>
										<Storyboard>
											<DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1.02" Duration="0:0:0.15"/>
											<DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1.02" Duration="0:0:0.15"/>
										</Storyboard>
									</BeginStoryboard>
								</Trigger.EnterActions>
								<Trigger.ExitActions>
									<BeginStoryboard>
										<Storyboard>
											<DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1" Duration="0:0:0.15"/>
											<DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1" Duration="0:0:0.15"/>
										</Storyboard>
									</BeginStoryboard>
								</Trigger.ExitActions>
							</Trigger>

							<!-- Selected -->
							<Trigger Property="IsSelected" Value="True">
								<Setter Property="Background" Value="#224422"/>
								<Setter Property="FontWeight" Value="Bold"/>
							</Trigger>

							<!-- Playing song highlight -->
							<DataTrigger Binding="{Binding IsPlaying}" Value="True">
								<Setter Property="Background" Value="#335522"/>
								<Setter Property="Foreground" Value="Lime"/>
								<Setter Property="FontWeight" Value="Bold"/>
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</ListView.ItemContainerStyle>

				<!-- Контекстное меню -->
				<ListView.ContextMenu>
					<ContextMenu Opened="SongsContextMenu_Opened"
                     Background="#2a2a2a"
                     Foreground="White"
                     BorderBrush="#444"
                     BorderThickness="1"
                     FontSize="14">
						<MenuItem Header="Информация о песне" Click="SongsListView_ShowDetails_Click"/>
						<MenuItem Header="Скачать песню" Click="DownloadSong_Click">
							<MenuItem.Icon>
								<materialDesign:PackIcon Kind="Download" Foreground="LightSkyBlue" Width="18" Height="18"/>
							</MenuItem.Icon>
						</MenuItem>
						<MenuItem x:Name="AddToPlaylistMenu"
                      Header="Добавить в плейлист"
                      Foreground="LimeGreen">
						</MenuItem>
						<MenuItem x:Name="RemoveFromPlaylistMenu"
                      Header="Удалить из плейлиста"
                      Foreground="#ff5555">
						</MenuItem>
						<Separator Margin="3,2"/>
						<MenuItem Header="Создать новый плейлист"
                      Command="{Binding CreatePlaylistCommand}"
                      Foreground="LightSkyBlue">
							<MenuItem.Icon>
								<materialDesign:PackIcon Kind="PlaylistPlus"
                                             Width="18" Height="18"
                                             Foreground="LightSkyBlue" />
							</MenuItem.Icon>
						</MenuItem>
					</ContextMenu>
				</ListView.ContextMenu>
			</ListView>
		</Grid>

		<Grid Grid.Row="2" Grid.ColumnSpan="2" Background="#181818">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="">
					<Button x:Name="RepeatModeButton"
        Width="60"
        Height="40"
        Background="Transparent"
        BorderBrush="{x:Null}"
        Click="RepeatButton_Click"
        ToolTip="Режим повтора">
						<materialDesign:PackIcon x:Name="RepeatIcon"
                             Kind="Repeat"
                             Foreground="White"
                             Width="28"
                             Height="28"/>
					</Button>
					<Button Command="{Binding PreviousCommand}" Margin="5">
						<materialDesign:PackIcon Kind="SkipPrevious" Width="24" Height="24" Foreground="White" />
					</Button>
					<Button Command="{Binding TogglePlayPauseCommand}" Margin="5">
						<Button.Style>
							<Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
								<Setter Property="Content">
									<Setter.Value>
										<materialDesign:PackIcon Kind="Play" Width="24" Height="24" Foreground="White" />
									</Setter.Value>
								</Setter>
								<Style.Triggers>
									<DataTrigger Binding="{Binding PlayerService.IsPlaying}" Value="True">
										<Setter Property="Content">
											<Setter.Value>
												<materialDesign:PackIcon Kind="Pause" Width="24" Height="24" Foreground="White" />
											</Setter.Value>
										</Setter>
									</DataTrigger>
								</Style.Triggers>
							</Style>
						</Button.Style>
					</Button>
					<Button Command="{Binding NextCommand}" Margin="5">
						<materialDesign:PackIcon Kind="SkipNext" Width="24" Height="24" Foreground="White" />
					</Button>
					<Button x:Name="ShuffleButton"
        Width="60"
        Height="40"
        Background="Transparent"
        BorderBrush="{x:Null}"
        Click="ShuffleButton_Click"
        ToolTip="Перемешать треки">
						<materialDesign:PackIcon x:Name="ShuffleIcon"
                             Kind="Shuffle"
                             Foreground="White"
                             Width="28"
                             Height="28"/>
					</Button>
					<TextBlock Margin="5" VerticalAlignment="Center" Foreground="White" FontSize="14">
						<TextBlock.Text>
							<MultiBinding Converter="{StaticResource SecondsToTimeConverter}">
								<Binding Path="PlayerService.PositionInSeconds" />
								<Binding Path="PlayerService.DurationInSeconds" />
							</MultiBinding>
						</TextBlock.Text>
					</TextBlock>
					<Slider x:Name="ProgressSlider" Value="{Binding PlayerService.PositionInSeconds, Mode=TwoWay}"
                            Minimum="0" Maximum="{Binding PlayerService.DurationInSeconds}"
                            Width="360" Margin="5" VerticalAlignment="Center" MouseMove="ProgressSlider_MouseMove"/>
					<ToggleButton 
    x:Name="BottomFavoriteButton"
    Width="40"
    Height="40"
    FontSize="28"
    Content="{Binding PlayerService.CurrentSong.IsFavoriteLocal, 
                      Converter={StaticResource FavoriteIconConverter}}"
    Foreground="{Binding PlayerService.CurrentSong.IsFavoriteLocal, 
                      Converter={StaticResource FavoriteColorConverter}}"
    IsChecked="{Binding PlayerService.CurrentSong.IsFavoriteLocal, Mode=OneWay}"
    Background="Transparent"
    BorderThickness="0"
    Command="{Binding ToggleFavoriteCommand}"
    CommandParameter="{Binding PlayerService.CurrentSong}" />
				</StackPanel>
				
				<StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10">
					<TextBlock Text="{Binding PlayerService.Volume, StringFormat={}{0:P0}, UpdateSourceTrigger=PropertyChanged}" 
                       Foreground="White" VerticalAlignment="Center" Margin="5,0" MinWidth="30"/>
					<materialDesign:PackIcon Kind="VolumeHigh" VerticalAlignment="Center" Margin="5" Foreground="White" Width="20" Height="20" />
					<Slider Value="{Binding PlayerService.Volume, Mode=TwoWay}" 
                            Minimum="0" Maximum="1" 
                            Width="100" Margin="5" VerticalAlignment="Center"/>
				</StackPanel>
			</Grid>
		</Grid>
		<Border Grid.Row="2" Grid.ColumnSpan="2" x:Name="NotificationBorder"
        Background="#AA000000"
        CornerRadius="8"
        Padding="14,8"
        Margin="20,0,0,20"
        HorizontalAlignment="Left"
        VerticalAlignment="Bottom"
        Visibility="Collapsed"
        Opacity="0"
        Panel.ZIndex="9999"
        IsHitTestVisible="False"
        MaxWidth="800">
			<TextBlock x:Name="NotificationText"
               Foreground="Lime"
               FontSize="16"
               FontWeight="SemiBold"
               TextWrapping="Wrap"
               TextTrimming="CharacterEllipsis" />
		</Border>
	</Grid>
</Window>